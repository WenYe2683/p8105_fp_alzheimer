---
title: "Geographic Analysis"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

library(tidyverse)
library(ggplot2)
library(maps)
library(stringr)
library(janitor)
```

# Data Loading

```{r data-loading, message=FALSE, warning=FALSE}
# Load Alzheimer's data
raw_az_data <- read.csv("data/2015-2022 Alzheimer Data.csv") |>
  janitor::clean_names()

raw_az_data <- raw_az_data[-nrow(raw_az_data), ]

az_clean <- raw_az_data |>
  filter(
    !is.na(data_value),
    !is.na(year_start),
    !is.na(location_abbr)
  )

# Filter for cognitive decline/impairment
az_cog <- az_clean |>
  filter(
    str_detect(topic, regex("cognitive decline|cognitive impairment",
                            ignore_case = TRUE))
  )

# Create base summary with age and sex groups
az_cog_summary_base <- az_cog |>
  mutate(
    age_group = case_when(
      stratification_category1 == "Age Group" ~ stratification1,
      TRUE ~ "Overall"
    ),
    sex_group = case_when(
      stratification_category2 == "Sex" ~ stratification2,
      TRUE ~ "Overall"
    )
  )

# Filter for 65+ overall
az_cog_65_overall <- az_cog_summary_base |>
  filter(
    age_group == "65 years or older",
    sex_group == "Overall"
  )
```

## Alzheimer's outcomes at state-year level

```{r}
az_state_year <- az_cog_65_overall |>
  filter(
    year_start %in% c(2015, 2016),
    sex_group == "Overall"
  ) |>
  group_by(
    year       = year_start,
    state_abbr = location_abbr,
    state_name = location_desc
  ) |>
  summarise(
    mean_prev = mean(data_value, na.rm = TRUE),
    .groups = "drop"
  )

head(az_state_year)
```

## Mapping Alzheimer's-related Cognitive Burden

### State-level choropleth map for 2015

```{r map_2015, message = FALSE, warning = FALSE}
az_2015 = az_state_year |> 
  filter(year == 2015)

us_map = map_data("state") |> as_tibble()

az_map_2015 = az_2015 |> 
  mutate(region = str_to_lower(state_name)) |> 
  inner_join(us_map, by = "region")

ggplot(az_map_2015,
       aes(long, lat, group = group, fill = mean_prev)) +
  geom_polygon(color = "white", linewidth = 0.2) +
  coord_fixed(1.3) +
  scale_fill_viridis_c(option = "C") +
  labs(
    title = "Alzheimer's-related cognitive prevalence (Age 65+, 2015)",
    fill  = "Prevalence (%)"
  ) +
  theme_void() +
  theme(legend.position = "right")
```

### State-level choropleth map for 2016

```{r map_2016, message = FALSE, warning = FALSE}
az_2016 = az_state_year |> 
  filter(year == 2016)

us_map = map_data("state") |> as_tibble()

az_map_2016 = az_2016 |> 
  mutate(region = str_to_lower(state_name)) |> 
  inner_join(us_map, by = "region")

ggplot(az_map_2016,
       aes(long, lat, group = group, fill = mean_prev)) +
  geom_polygon(color = "white", linewidth = 0.2) +
  coord_fixed(1.3) +
  scale_fill_viridis_c(option = "C") +
  labs(
    title = "Alzheimer's-related cognitive prevalence (Age 65+, 2016)",
    fill  = "Prevalence (%)"
  ) +
  theme_void() +
  theme(legend.position = "right")
```

### Side-by-side Comparison (2015 vs 2016)

```{r map_compare_2015_2016, message = FALSE, warning = FALSE}
az_15_16 = az_state_year |> 
  filter(year %in% c(2015, 2016))

us_map = map_data("state") |> as_tibble()

az_map_15_16 = az_15_16 |> 
  mutate(region = str_to_lower(state_name)) |> 
  inner_join(us_map, by = "region")

ggplot(az_map_15_16,
       aes(long, lat, group = group, fill = mean_prev)) +
  geom_polygon(color = "white", linewidth = 0.2) +
  coord_fixed(1.3) +
  scale_fill_viridis_c(option = "C") +
  labs(
    title = "Alzheimer's-related cognitive prevalence (Age 65+, 2015â€“2016)",
    fill  = "Prevalence (%)"
  ) +
  theme_void() +
  theme(legend.position = "right") +
  facet_wrap(~ year)
```

Geographic patterns of Alzheimer's-related cognitive prevalence were visualized using state-level choropleth maps for 2015 and 2016. In both years, several Southern and Southeastern states showed higher prevalence levels, while many Western and Northeastern states displayed noticeably lower burdens. The spatial distribution remained largely consistent between 2015 and 2016, suggesting limited short-term change in geographic patterns of cognitive burden among adults aged 65+.